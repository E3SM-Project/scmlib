## ARM/ASR Diagnostics Package for E3SM SCM and DP-EAMxx

This is a diagnostics package for the E3SM SCM and Doubly-Periodic Configuration of EAMxx (DP-EAMxx).

This diagnostics package is used by selecting the example script:

`diagnostics_user_driver.py`

Make a copy of this, which will be ignored by git.  This script then needs to be edited to add
the relevant data sets, case specifics, observation files, and plotting styles to fit the user's needs.
The new user script can then be executed after loading the suitable environment (see Setup Notes).

Development of this diagnostics package was primarily supported by the Atmospheric System Research program, Tying in High Resolution E3SM with ARM Data (THREAD) project (SCW1800) and partially supported by the Atmospheric Radiation Measurement (ARM) program, funded by the U.S. Department of Energy (DOE), Office of Science, Office of Biological and Environmental Research.

--------------------------------------------------------------------------------

### TABLE OF CONTENTS
  - [Package Overview](#package-overview)
  - [Setup Notes](#setup-notes)
  - [Valid E3SM SCM Input Data](#valid-e3sm-scm-input-data)
  - [Valid DP-EAMxx Input Data](#valid-dp-eamxx-input-data)
  - [Adding Datasets](#adding-datasets)
  - [User Specifications](#user-specifications)
  - [Observation and LES Datasets](#observation-and-les-datasets)
  - [Development Plans](#development-plans)

--------------------------------------------------------------------------------

### Package Overview

This diagnostics package is designed to provide users with a simple, user-friendly interface for quickly evaluating process-level simulations using the E3SM SCM and DP-EAMxx configurations. It also facilitates straightforward comparisons with ARM observations and large eddy simulation (LES) results, where available. The package is not intended for generating publication quality figures or performing advanced analysis. Rather, it offers a basic suite of plots to help users assess the fidelity of their simulations and identify areas for more detailed investigation. 

--------------------------------------------------------------------------------

### Setup Notes

It is recommended to use the E3SM unified environment to run this package.

On Perlmutter:

`source /global/common/software/e3sm/anaconda_envs/load_latest_e3sm_unified_pm-cpu.sh`

On Chrysalis:

`source /lcrc/soft/climate/e3sm-unified/load_latest_e3sm_unified_chrysalis.sh`

Alternatively a user can create their own environment, if they wish.  The following packages would be needed in such an environment:
  ```
  conda create --name e3sm_asr_diag python=3.10 -c conda-forge xarray numpy matplotlib jinja2 netCDF4 scipy 
  ```
After creating the environment it can be activated via:

  `source activate e3sm_asr_diag`

--------------------------------------------------------------------------------

### Valid E3SM SCM Input Data

The default output generated by the E3SM SCM in the `*.eam.h0.` can be used directly. 

For vertical coordinates, please ensure you are outputting the variables `Z3` and `PS` (output by default in the standard `*eam.h0*` files).  Failure to do so will force the diagnostics package to plot using the reference pressure coordinate, which will likely not be accurate if you are comparing against observational or LES datasets.

All diagnostic variables must be contained in a single NetCDF output file, and all variables must share a common time coordinate. If you append data from other output tapes, ensure that the time steps and coordinates are consistent across all variables. Note that the default E3SM SCM output can be customized, additional variables can be added as needed to tailor the output to your specific analysis needs.

--------------------------------------------------------------------------------

### Valid DP-EAMxx Input Data

A valid DP-EAMxx dataset should be horizontally averaged by using the EAMxx `_horiz_avg` reducer.  [This is an example of a YAML file](https://github.com/E3SM-Project/scmlib/blob/master/DPxx_SCREAM_SCRIPTS/yaml_file_example/scream_horiz_avg_output_15min.yaml) that can be used in your DP-EAMxx run that will produce a compatible output stream to be used in the DP-EAMxx diagnostics package.  All diagnostic variables must be contained in a single NetCDF output file, and all variables must share a common time coordinate. If you append data from other output tapes, ensure that the time steps and coordinates are consistent across all variables.

For vertical coordinates, please ensure you are outputting the variables `zmid_horiz_avg` and `ps_horiz_avg` to your output stream.  Failure to do so will force the diagnostics package to plot using the reference pressure coordinate, which will likely not be accurate if you are comparing against observational or LES datasets.

Doing averaging offline on a DP-EAMxx output stream and supplying that dataset may work with the package but comes with no warranty of working at this time.  

--------------------------------------------------------------------------------

### Adding Datasets

--------------------------------------------------------------------------------

### User Specifications

--------------------------------------------------------------------------------

### Observation and LES Files

--------------------------------------------------------------------------------

### Development Plans


